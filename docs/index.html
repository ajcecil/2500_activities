<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <title>USDA Soil Texture Triangle</title>
  <style>
    body { margin:0; background:#fff; }
    #chart { width:100%; height:95vh; }
  </style>
</head>
<body>
<div id="chart"></div>

<script>
  // Define USDA polygons (simplified example – fill in with full coords from your R data)
  const polygons = [
    {
      class: "Sand",
      a: [0, 0, 15, 0], // clay
      b: [100, 85, 70, 100], // sand
      c: [0, 15, 15, 0],     // silt
      color: "rgba(255, 215, 0, 0.3)"
    },
    {
      class: "Clay",
      a: [40, 45, 55, 40],
      b: [35, 20, 0, 35],
      c: [25, 35, 45, 25],
      color: "rgba(200, 0, 0, 0.3)"
    }
    // … add all other USDA classes with full coordinates
  ];

  // Convert polygons into Plotly traces
  const polygonTraces = polygons.map(poly => ({
    type: "scatterternary",
    mode: "lines",
    a: [...poly.a, poly.a[0]], // close loop
    b: [...poly.b, poly.b[0]],
    c: [...poly.c, poly.c[0]],
    fill: "toself",
    fillcolor: poly.color,
    line: { color: "black", width: 1 },
    name: poly.class,
    hoverinfo: "skip" // don’t show hover on polygons
  }));

  // Sample marker (user input)
  let clay = 20, sand = 50, silt = 30;
  let textureClass = "Loam"; // <-- you’d compute this based on clay/sand/silt

  const pointTrace = {
    type: "scatterternary",
    mode: "markers",
    a: [clay],
    b: [sand],
    c: [silt],
    marker: { size: 12, color: "red" },
    hovertemplate:
      `Clay: %{a}%<br>` +
      `Sand: %{b}%<br>` +
      `Silt: %{c}%<br>` +
      `Texture Class: ${textureClass}<extra></extra>`
  };

  const layout = {
    ternary: {
      sum: 100,
      aaxis: { title: "Clay", ticksuffix: "%", min:0 },
      baxis: { title: "Sand", ticksuffix: "%", min:0 },
      caxis: { title: "Silt", ticksuffix: "%", min:0 },
    },
    showlegend: false
  };

  Plotly.newPlot("chart", [...polygonTraces, pointTrace], layout);
</script>
</body>
</html>

